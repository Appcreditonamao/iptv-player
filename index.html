<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV Player</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>
    <h2>Lista de Canais</h2>
    <ul id="channel-list"></ul>
    
    <h2>Player</h2>
    <video id="video" controls width="640" height="360"></video>

    <script>
        const m3uURL = "http://cdn.srvmain.top:80/get.php?username=deivson&password=123&type=m3u_plus";
        const channelList = document.getElementById("channel-list");
        const video = document.getElementById("video");

        // Função para carregar e processar a lista M3U
        async function loadM3U() {
            try {
                let response = await fetch(m3uURL);
                let text = await response.text();
                
                let lines = text.split("\n");
                let channels = [];

                for (let i = 0; i < lines.length; i++) {
                    if (lines[i].startsWith("#EXTINF")) {
                        let name = lines[i].split(",")[1];  // Nome do canal
                        let url = lines[i + 1]?.trim();     // URL do canal

                        if (url && url.startsWith("http")) {
                            channels.push({ name, url });
                        }
                    }
                }

                showChannels(channels);
            } catch (error) {
                console.error("Erro ao carregar a lista M3U:", error);
            }
        }

        // Exibe os canais na tela
        function showChannels(channels) {
            channelList.innerHTML = "";
            channels.forEach(channel => {
                let li = document.createElement("li");
                li.textContent = channel.name;
                li.style.cursor = "pointer";
                li.onclick = () => playChannel(channel.url);
                channelList.appendChild(li);
            });
        }

        // Reproduz um canal ao clicar
        function playChannel(url) {
            if (Hls.isSupported()) {
                let hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
            } else {
                video.src = url;
                video.play();
            }
        }

        loadM3U();
    </script>
</body>
</html>
